<!DOCTYPE html>
<html  style="margin:0;padding:0">
  <head>
  <script src="https://code.jquery.com/jquery-3.1.0.js" integrity="sha256-slogkvB1K3VOkzAI8QITxV3VzpOnkeNVsKvtkYLMjfk="   crossorigin="anonymous"></script>
    <title>jQuery injection into webview preload</title>
  </head>
  <body style="margin:0px; padding:0px;overflow:hidden;">
    <webview id="webview" preload="./src/injectKeep.js" src="http://keep.google.com" style="position:absolute;width:100%;height:100%;"></webview>
    <script>

    var webview = document.getElementById("webview")
    webview.addEventListener("dom-ready", function() {
        webview.insertCSS(".gb_ec { background-color: red !important; }");
        console.log("done")
    });

  var ipcMain = require('electron').ipcMain

  webview.addEventListener("ipc-message", function (e) {
    if (e.channel === "window-data") {
      // console.log(e.args[0]);

      $(".tab.active .tab-favicon").attr("src", e.args[0].favicon);
      $(".tab.active .tab-title").html(e.args[0].title);
      $("#url-bar").val(e.args[0].url);

      $("#aries-titlebar h1").html("Aries | " + e.args[0].title);
    }

    // TODO
    // Make this better...cancel out setTimeout?
    var timer;

    if (e.channel === "mouseover-href") {
      // console.log(e.args[0]);
      $(".linker").html(e.args[0]).stop().addClass("active");

      clearTimeout(timer);

      timer = setTimeout(function () {
        $(".linker").stop().removeClass("active");
      }, 1500);
    }
  });

    </script>
  </body>
</html>